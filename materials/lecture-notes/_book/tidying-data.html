<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Lecture Notes: Data Science using R for Humanities and Social Science</title>
  <meta name="description" content="Lecture Notes: Data Science using R for Humanities and Social Science">
  <meta name="generator" content="bookdown 0.4 and GitBook 2.6.7">

  <meta property="og:title" content="Lecture Notes: Data Science using R for Humanities and Social Science" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Lecture Notes: Data Science using R for Humanities and Social Science" />
  
  
  

<meta name="author" content="Héctor Corrada Bravo">


<meta name="date" content="2017-06-07">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="ingesting-data.html">
<link rel="next" href="visualizing-data.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preamble</a></li>
<li class="chapter" data-level="2" data-path="introduction-and-overview.html"><a href="introduction-and-overview.html"><i class="fa fa-check"></i><b>2</b> Introduction and Overview</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction-and-overview.html"><a href="introduction-and-overview.html#what-is-data-science"><i class="fa fa-check"></i><b>2.1</b> What is Data Science?</a><ul>
<li class="chapter" data-level="2.1.1" data-path="introduction-and-overview.html"><a href="introduction-and-overview.html#data"><i class="fa fa-check"></i><b>2.1.1</b> Data</a></li>
<li class="chapter" data-level="2.1.2" data-path="introduction-and-overview.html"><a href="introduction-and-overview.html#specific-questions"><i class="fa fa-check"></i><b>2.1.2</b> Specific Questions</a></li>
<li class="chapter" data-level="2.1.3" data-path="introduction-and-overview.html"><a href="introduction-and-overview.html#interdisciplinary-activities"><i class="fa fa-check"></i><b>2.1.3</b> Interdisciplinary Activities</a></li>
<li class="chapter" data-level="2.1.4" data-path="introduction-and-overview.html"><a href="introduction-and-overview.html#data-centric-artifacts-and-applications"><i class="fa fa-check"></i><b>2.1.4</b> Data-centric artifacts and applications</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="introduction-and-overview.html"><a href="introduction-and-overview.html#why-data-science"><i class="fa fa-check"></i><b>2.2</b> Why Data Science?</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-and-overview.html"><a href="introduction-and-overview.html#data-science-in-humanities-and-social-sciences"><i class="fa fa-check"></i><b>2.3</b> Data Science in Humanities and Social Sciences</a></li>
<li class="chapter" data-level="2.4" data-path="introduction-and-overview.html"><a href="introduction-and-overview.html#course-organization"><i class="fa fa-check"></i><b>2.4</b> Course organization</a><ul>
<li class="chapter" data-level="2.4.1" data-path="introduction-and-overview.html"><a href="introduction-and-overview.html#day-1-introduction-and-preparation"><i class="fa fa-check"></i><b>2.4.1</b> Day 1: Introduction and preparation</a></li>
<li class="chapter" data-level="2.4.2" data-path="introduction-and-overview.html"><a href="introduction-and-overview.html#day-2-use-cases"><i class="fa fa-check"></i><b>2.4.2</b> Day 2: Use cases</a></li>
<li class="chapter" data-level="2.4.3" data-path="introduction-and-overview.html"><a href="introduction-and-overview.html#day-3-presentation-and-teaching"><i class="fa fa-check"></i><b>2.4.3</b> Day 3: Presentation and teaching</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="introduction-and-overview.html"><a href="introduction-and-overview.html#general-workflow"><i class="fa fa-check"></i><b>2.5</b> General Workflow</a><ul>
<li class="chapter" data-level="2.5.1" data-path="introduction-and-overview.html"><a href="introduction-and-overview.html#defining-the-goal"><i class="fa fa-check"></i><b>2.5.1</b> Defining the goal</a></li>
<li class="chapter" data-level="2.5.2" data-path="introduction-and-overview.html"><a href="introduction-and-overview.html#data-collection-and-management"><i class="fa fa-check"></i><b>2.5.2</b> Data collection and Management</a></li>
<li class="chapter" data-level="2.5.3" data-path="introduction-and-overview.html"><a href="introduction-and-overview.html#modeling"><i class="fa fa-check"></i><b>2.5.3</b> Modeling</a></li>
<li class="chapter" data-level="2.5.4" data-path="introduction-and-overview.html"><a href="introduction-and-overview.html#model-evaluation"><i class="fa fa-check"></i><b>2.5.4</b> Model evaluation</a></li>
<li class="chapter" data-level="2.5.5" data-path="introduction-and-overview.html"><a href="introduction-and-overview.html#presentation"><i class="fa fa-check"></i><b>2.5.5</b> Presentation</a></li>
<li class="chapter" data-level="2.5.6" data-path="introduction-and-overview.html"><a href="introduction-and-overview.html#deployment"><i class="fa fa-check"></i><b>2.5.6</b> Deployment</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="an-illustrative-analysis.html"><a href="an-illustrative-analysis.html"><i class="fa fa-check"></i><b>3</b> An Illustrative Analysis</a><ul>
<li class="chapter" data-level="3.1" data-path="an-illustrative-analysis.html"><a href="an-illustrative-analysis.html#gathering-data"><i class="fa fa-check"></i><b>3.1</b> Gathering data</a><ul>
<li class="chapter" data-level="3.1.1" data-path="an-illustrative-analysis.html"><a href="an-illustrative-analysis.html#movie-ratings"><i class="fa fa-check"></i><b>3.1.1</b> Movie ratings</a></li>
<li class="chapter" data-level="3.1.2" data-path="an-illustrative-analysis.html"><a href="an-illustrative-analysis.html#movie-budgets-and-revenue"><i class="fa fa-check"></i><b>3.1.2</b> Movie budgets and revenue</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="an-illustrative-analysis.html"><a href="an-illustrative-analysis.html#manipulating-the-data"><i class="fa fa-check"></i><b>3.2</b> Manipulating the data</a></li>
<li class="chapter" data-level="3.3" data-path="an-illustrative-analysis.html"><a href="an-illustrative-analysis.html#visualizing-the-data"><i class="fa fa-check"></i><b>3.3</b> Visualizing the data</a></li>
<li class="chapter" data-level="3.4" data-path="an-illustrative-analysis.html"><a href="an-illustrative-analysis.html#modeling-data"><i class="fa fa-check"></i><b>3.4</b> Modeling data</a></li>
<li class="chapter" data-level="3.5" data-path="an-illustrative-analysis.html"><a href="an-illustrative-analysis.html#visualizing-model-result"><i class="fa fa-check"></i><b>3.5</b> Visualizing model result</a></li>
<li class="chapter" data-level="3.6" data-path="an-illustrative-analysis.html"><a href="an-illustrative-analysis.html#abstracting-the-analysis"><i class="fa fa-check"></i><b>3.6</b> Abstracting the analysis</a></li>
<li class="chapter" data-level="3.7" data-path="an-illustrative-analysis.html"><a href="an-illustrative-analysis.html#making-analyses-accessible"><i class="fa fa-check"></i><b>3.7</b> Making analyses accessible</a></li>
<li class="chapter" data-level="3.8" data-path="an-illustrative-analysis.html"><a href="an-illustrative-analysis.html#summary"><i class="fa fa-check"></i><b>3.8</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="setting-up-r.html"><a href="setting-up-r.html"><i class="fa fa-check"></i><b>4</b> Setting up R</a><ul>
<li class="chapter" data-level="4.1" data-path="setting-up-r.html"><a href="setting-up-r.html#setting-up-r-1"><i class="fa fa-check"></i><b>4.1</b> Setting up R</a></li>
<li class="chapter" data-level="4.2" data-path="setting-up-r.html"><a href="setting-up-r.html#setting-up-rstudio"><i class="fa fa-check"></i><b>4.2</b> Setting up Rstudio</a></li>
<li class="chapter" data-level="4.3" data-path="setting-up-r.html"><a href="setting-up-r.html#a-first-look-at-rstudio"><i class="fa fa-check"></i><b>4.3</b> A first look at Rstudio</a><ul>
<li class="chapter" data-level="4.3.1" data-path="setting-up-r.html"><a href="setting-up-r.html#interactive-console"><i class="fa fa-check"></i><b>4.3.1</b> Interactive Console</a></li>
<li class="chapter" data-level="4.3.2" data-path="setting-up-r.html"><a href="setting-up-r.html#data-viewer"><i class="fa fa-check"></i><b>4.3.2</b> Data Viewer</a></li>
<li class="chapter" data-level="4.3.3" data-path="setting-up-r.html"><a href="setting-up-r.html#names-values-and-functions"><i class="fa fa-check"></i><b>4.3.3</b> Names, values and functions</a></li>
<li class="chapter" data-level="4.3.4" data-path="setting-up-r.html"><a href="setting-up-r.html#plotting"><i class="fa fa-check"></i><b>4.3.4</b> Plotting</a></li>
<li class="chapter" data-level="4.3.5" data-path="setting-up-r.html"><a href="setting-up-r.html#editor"><i class="fa fa-check"></i><b>4.3.5</b> Editor</a></li>
<li class="chapter" data-level="4.3.6" data-path="setting-up-r.html"><a href="setting-up-r.html#files-viewer"><i class="fa fa-check"></i><b>4.3.6</b> Files viewer</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="setting-up-r.html"><a href="setting-up-r.html#r-packages"><i class="fa fa-check"></i><b>4.4</b> R packages</a></li>
<li class="chapter" data-level="4.5" data-path="setting-up-r.html"><a href="setting-up-r.html#finishing-your-setup"><i class="fa fa-check"></i><b>4.5</b> Finishing your setup</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="r-principles.html"><a href="r-principles.html"><i class="fa fa-check"></i><b>5</b> R Principles</a><ul>
<li class="chapter" data-level="5.1" data-path="r-principles.html"><a href="r-principles.html#some-history"><i class="fa fa-check"></i><b>5.1</b> Some history</a></li>
<li class="chapter" data-level="5.2" data-path="r-principles.html"><a href="r-principles.html#additional-r-resources"><i class="fa fa-check"></i><b>5.2</b> Additional R resources</a></li>
<li class="chapter" data-level="5.3" data-path="r-principles.html"><a href="r-principles.html#literate-programming"><i class="fa fa-check"></i><b>5.3</b> Literate Programming</a></li>
<li class="chapter" data-level="5.4" data-path="r-principles.html"><a href="r-principles.html#a-data-analysis-to-get-us-going"><i class="fa fa-check"></i><b>5.4</b> A data analysis to get us going</a></li>
<li class="chapter" data-level="5.5" data-path="r-principles.html"><a href="r-principles.html#getting-data"><i class="fa fa-check"></i><b>5.5</b> Getting data</a></li>
<li class="chapter" data-level="5.6" data-path="r-principles.html"><a href="r-principles.html#variables-and-value"><i class="fa fa-check"></i><b>5.6</b> Variables and Value</a></li>
<li class="chapter" data-level="5.7" data-path="r-principles.html"><a href="r-principles.html#indexing"><i class="fa fa-check"></i><b>5.7</b> Indexing</a></li>
<li class="chapter" data-level="5.8" data-path="r-principles.html"><a href="r-principles.html#exploration"><i class="fa fa-check"></i><b>5.8</b> Exploration</a></li>
<li class="chapter" data-level="5.9" data-path="r-principles.html"><a href="r-principles.html#functions"><i class="fa fa-check"></i><b>5.9</b> Functions</a></li>
<li class="chapter" data-level="5.10" data-path="r-principles.html"><a href="r-principles.html#a-note-on-data-types"><i class="fa fa-check"></i><b>5.10</b> A note on data types</a></li>
<li class="chapter" data-level="5.11" data-path="r-principles.html"><a href="r-principles.html#thinking-in-vectors"><i class="fa fa-check"></i><b>5.11</b> Thinking in vectors</a></li>
<li class="chapter" data-level="5.12" data-path="r-principles.html"><a href="r-principles.html#lists-vs.vectors"><i class="fa fa-check"></i><b>5.12</b> Lists vs. vectors</a></li>
<li class="chapter" data-level="5.13" data-path="r-principles.html"><a href="r-principles.html#making-the-process-explicit-with-pipes"><i class="fa fa-check"></i><b>5.13</b> Making the process explicit with pipes</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ingesting-data.html"><a href="ingesting-data.html"><i class="fa fa-check"></i><b>6</b> Ingesting data</a><ul>
<li class="chapter" data-level="6.1" data-path="ingesting-data.html"><a href="ingesting-data.html#structured-ingestion"><i class="fa fa-check"></i><b>6.1</b> Structured ingestion</a><ul>
<li class="chapter" data-level="6.1.1" data-path="ingesting-data.html"><a href="ingesting-data.html#csv-files-and-similar"><i class="fa fa-check"></i><b>6.1.1</b> CSV files (and similar)</a></li>
<li class="chapter" data-level="6.1.2" data-path="ingesting-data.html"><a href="ingesting-data.html#excel-spreadsheets"><i class="fa fa-check"></i><b>6.1.2</b> Excel spreadsheets</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="ingesting-data.html"><a href="ingesting-data.html#scraping"><i class="fa fa-check"></i><b>6.2</b> Scraping</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="tidying-data.html"><a href="tidying-data.html"><i class="fa fa-check"></i><b>7</b> Tidying data</a><ul>
<li class="chapter" data-level="7.1" data-path="tidying-data.html"><a href="tidying-data.html#tidy-data"><i class="fa fa-check"></i><b>7.1</b> Tidy Data</a></li>
<li class="chapter" data-level="7.2" data-path="tidying-data.html"><a href="tidying-data.html#common-problems-in-messy-data"><i class="fa fa-check"></i><b>7.2</b> Common problems in messy data</a><ul>
<li class="chapter" data-level="7.2.1" data-path="tidying-data.html"><a href="tidying-data.html#headers-as-values"><i class="fa fa-check"></i><b>7.2.1</b> Headers as values</a></li>
<li class="chapter" data-level="7.2.2" data-path="tidying-data.html"><a href="tidying-data.html#multiple-variables-in-one-column"><i class="fa fa-check"></i><b>7.2.2</b> Multiple variables in one column</a></li>
<li class="chapter" data-level="7.2.3" data-path="tidying-data.html"><a href="tidying-data.html#variables-stored-in-both-rows-and-columns"><i class="fa fa-check"></i><b>7.2.3</b> Variables stored in both rows and columns</a></li>
<li class="chapter" data-level="7.2.4" data-path="tidying-data.html"><a href="tidying-data.html#multiple-types-in-one-table"><i class="fa fa-check"></i><b>7.2.4</b> Multiple types in one table</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="tidying-data.html"><a href="tidying-data.html#data-wrangling-with-dplyr"><i class="fa fa-check"></i><b>7.3</b> Data wrangling with <code>dplyr</code></a><ul>
<li class="chapter" data-level="7.3.1" data-path="tidying-data.html"><a href="tidying-data.html#dplyr"><i class="fa fa-check"></i><b>7.3.1</b> <code>dplyr</code></a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="tidying-data.html"><a href="tidying-data.html#single-table-manipulation"><i class="fa fa-check"></i><b>7.4</b> Single-table manipulation</a><ul>
<li class="chapter" data-level="7.4.1" data-path="tidying-data.html"><a href="tidying-data.html#subsetting-observations"><i class="fa fa-check"></i><b>7.4.1</b> Subsetting Observations</a></li>
<li class="chapter" data-level="7.4.2" data-path="tidying-data.html"><a href="tidying-data.html#subsetting-variables"><i class="fa fa-check"></i><b>7.4.2</b> Subsetting Variables</a></li>
<li class="chapter" data-level="7.4.3" data-path="tidying-data.html"><a href="tidying-data.html#creating-new-variables"><i class="fa fa-check"></i><b>7.4.3</b> Creating New Variables</a></li>
<li class="chapter" data-level="7.4.4" data-path="tidying-data.html"><a href="tidying-data.html#summarizing-data"><i class="fa fa-check"></i><b>7.4.4</b> Summarizing Data</a></li>
<li class="chapter" data-level="7.4.5" data-path="tidying-data.html"><a href="tidying-data.html#grouping-data"><i class="fa fa-check"></i><b>7.4.5</b> Grouping Data</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="tidying-data.html"><a href="tidying-data.html#two-table-manipulation"><i class="fa fa-check"></i><b>7.5</b> Two-table manipulation</a><ul>
<li class="chapter" data-level="7.5.1" data-path="tidying-data.html"><a href="tidying-data.html#left-join"><i class="fa fa-check"></i><b>7.5.1</b> Left Join</a></li>
<li class="chapter" data-level="7.5.2" data-path="tidying-data.html"><a href="tidying-data.html#join-conditions"><i class="fa fa-check"></i><b>7.5.2</b> Join conditions</a></li>
<li class="chapter" data-level="7.5.3" data-path="tidying-data.html"><a href="tidying-data.html#filtering-joins"><i class="fa fa-check"></i><b>7.5.3</b> Filtering Joins</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="tidying-data.html"><a href="tidying-data.html#final-note-on-dplyr"><i class="fa fa-check"></i><b>7.6</b> Final note on <code>dplyr</code></a></li>
<li class="chapter" data-level="7.7" data-path="tidying-data.html"><a href="tidying-data.html#exercise"><i class="fa fa-check"></i><b>7.7</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="visualizing-data.html"><a href="visualizing-data.html"><i class="fa fa-check"></i><b>8</b> Visualizing data</a><ul>
<li class="chapter" data-level="8.0.1" data-path="visualizing-data.html"><a href="visualizing-data.html#eda-exploratory-data-analysis"><i class="fa fa-check"></i><b>8.0.1</b> EDA (Exploratory Data Analysis)</a></li>
<li class="chapter" data-level="8.1" data-path="visualizing-data.html"><a href="visualizing-data.html#visualization-of-single-variables"><i class="fa fa-check"></i><b>8.1</b> Visualization of single variables</a><ul>
<li class="chapter" data-level="8.1.1" data-path="visualizing-data.html"><a href="visualizing-data.html#visualization-of-pairs-of-variables"><i class="fa fa-check"></i><b>8.1.1</b> Visualization of pairs of variables</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="visualizing-data.html"><a href="visualizing-data.html#eda-with-the-grammar-of-graphics"><i class="fa fa-check"></i><b>8.2</b> EDA with the grammar of graphics</a><ul>
<li class="chapter" data-level="8.2.1" data-path="visualizing-data.html"><a href="visualizing-data.html#other-aesthetics"><i class="fa fa-check"></i><b>8.2.1</b> Other aesthetics</a></li>
<li class="chapter" data-level="8.2.2" data-path="visualizing-data.html"><a href="visualizing-data.html#faceting"><i class="fa fa-check"></i><b>8.2.2</b> Faceting</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="visualizing-data.html"><a href="visualizing-data.html#exercise-1"><i class="fa fa-check"></i><b>8.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="capstone-project-1.html"><a href="capstone-project-1.html"><i class="fa fa-check"></i><b>9</b> Capstone Project 1</a><ul>
<li class="chapter" data-level="9.1" data-path="capstone-project-1.html"><a href="capstone-project-1.html#project-1"><i class="fa fa-check"></i><b>9.1</b> Project 1</a></li>
<li class="chapter" data-level="9.2" data-path="capstone-project-1.html"><a href="capstone-project-1.html#project-2"><i class="fa fa-check"></i><b>9.2</b> Project 2</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="introduction-to-tidy-regression-analysis.html"><a href="introduction-to-tidy-regression-analysis.html"><i class="fa fa-check"></i><b>10</b> Introduction to tidy regression analysis</a><ul>
<li class="chapter" data-level="10.1" data-path="introduction-to-tidy-regression-analysis.html"><a href="introduction-to-tidy-regression-analysis.html#simple-regression"><i class="fa fa-check"></i><b>10.1</b> Simple Regression</a></li>
<li class="chapter" data-level="10.2" data-path="introduction-to-tidy-regression-analysis.html"><a href="introduction-to-tidy-regression-analysis.html#inference"><i class="fa fa-check"></i><b>10.2</b> Inference</a><ul>
<li class="chapter" data-level="10.2.1" data-path="introduction-to-tidy-regression-analysis.html"><a href="introduction-to-tidy-regression-analysis.html#confidence-interval"><i class="fa fa-check"></i><b>10.2.1</b> Confidence Interval</a></li>
<li class="chapter" data-level="10.2.2" data-path="introduction-to-tidy-regression-analysis.html"><a href="introduction-to-tidy-regression-analysis.html#the-t-statistic-and-the-t-distribution"><i class="fa fa-check"></i><b>10.2.2</b> The <span class="math inline">\(t\)</span>-statistic and the <span class="math inline">\(t\)</span>-distribution</a></li>
<li class="chapter" data-level="10.2.3" data-path="introduction-to-tidy-regression-analysis.html"><a href="introduction-to-tidy-regression-analysis.html#global-fit"><i class="fa fa-check"></i><b>10.2.3</b> Global Fit</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="introduction-to-tidy-regression-analysis.html"><a href="introduction-to-tidy-regression-analysis.html#some-important-technicalities"><i class="fa fa-check"></i><b>10.3</b> Some important technicalities</a></li>
<li class="chapter" data-level="10.4" data-path="introduction-to-tidy-regression-analysis.html"><a href="introduction-to-tidy-regression-analysis.html#issues-with-linear-regression"><i class="fa fa-check"></i><b>10.4</b> Issues with linear regression</a><ul>
<li class="chapter" data-level="10.4.1" data-path="introduction-to-tidy-regression-analysis.html"><a href="introduction-to-tidy-regression-analysis.html#non-linearity-of-outcome-predictor-relationship"><i class="fa fa-check"></i><b>10.4.1</b> Non-linearity of outcome-predictor relationship</a></li>
<li class="chapter" data-level="10.4.2" data-path="introduction-to-tidy-regression-analysis.html"><a href="introduction-to-tidy-regression-analysis.html#correlated-error"><i class="fa fa-check"></i><b>10.4.2</b> Correlated Error</a></li>
<li class="chapter" data-level="10.4.3" data-path="introduction-to-tidy-regression-analysis.html"><a href="introduction-to-tidy-regression-analysis.html#non-constant-variance"><i class="fa fa-check"></i><b>10.4.3</b> Non-constant variance</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="introduction-to-tidy-regression-analysis.html"><a href="introduction-to-tidy-regression-analysis.html#multivariate-regression"><i class="fa fa-check"></i><b>10.5</b> Multivariate Regression</a><ul>
<li class="chapter" data-level="10.5.1" data-path="introduction-to-tidy-regression-analysis.html"><a href="introduction-to-tidy-regression-analysis.html#estimation-in-multivariate-regression"><i class="fa fa-check"></i><b>10.5.1</b> Estimation in multivariate regression</a></li>
<li class="chapter" data-level="10.5.2" data-path="introduction-to-tidy-regression-analysis.html"><a href="introduction-to-tidy-regression-analysis.html#statistical-statements-contd"><i class="fa fa-check"></i><b>10.5.2</b> Statistical statements (cont’d)</a></li>
<li class="chapter" data-level="10.5.3" data-path="introduction-to-tidy-regression-analysis.html"><a href="introduction-to-tidy-regression-analysis.html#the-f-test"><i class="fa fa-check"></i><b>10.5.3</b> The F-test</a></li>
<li class="chapter" data-level="10.5.4" data-path="introduction-to-tidy-regression-analysis.html"><a href="introduction-to-tidy-regression-analysis.html#categorical-predictors-contd"><i class="fa fa-check"></i><b>10.5.4</b> Categorical predictors (cont’d)</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="introduction-to-tidy-regression-analysis.html"><a href="introduction-to-tidy-regression-analysis.html#interactions-in-linear-models"><i class="fa fa-check"></i><b>10.6</b> Interactions in linear models</a></li>
<li class="chapter" data-level="10.7" data-path="introduction-to-tidy-regression-analysis.html"><a href="introduction-to-tidy-regression-analysis.html#additional-issues-with-linear-regression"><i class="fa fa-check"></i><b>10.7</b> Additional issues with linear regression</a></li>
<li class="chapter" data-level="10.8" data-path="introduction-to-tidy-regression-analysis.html"><a href="introduction-to-tidy-regression-analysis.html#exercise-2"><i class="fa fa-check"></i><b>10.8</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="text-analysis.html"><a href="text-analysis.html"><i class="fa fa-check"></i><b>11</b> Text analysis</a></li>
<li class="chapter" data-level="12" data-path="capstone-2-project.html"><a href="capstone-2-project.html"><i class="fa fa-check"></i><b>12</b> Capstone 2 Project</a></li>
<li class="chapter" data-level="13" data-path="publishing-analyses-with-r.html"><a href="publishing-analyses-with-r.html"><i class="fa fa-check"></i><b>13</b> Publishing Analyses with R</a><ul>
<li class="chapter" data-level="13.1" data-path="publishing-analyses-with-r.html"><a href="publishing-analyses-with-r.html#rmarkdown"><i class="fa fa-check"></i><b>13.1</b> RMarkdown</a></li>
<li class="chapter" data-level="13.2" data-path="publishing-analyses-with-r.html"><a href="publishing-analyses-with-r.html#shiny"><i class="fa fa-check"></i><b>13.2</b> Shiny</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="teaching-with-r.html"><a href="teaching-with-r.html"><i class="fa fa-check"></i><b>14</b> Teaching with R</a><ul>
<li class="chapter" data-level="14.1" data-path="teaching-with-r.html"><a href="teaching-with-r.html#course-materials"><i class="fa fa-check"></i><b>14.1</b> Course materials</a></li>
<li class="chapter" data-level="14.2" data-path="teaching-with-r.html"><a href="teaching-with-r.html#assignments"><i class="fa fa-check"></i><b>14.2</b> Assignments</a></li>
<li class="chapter" data-level="14.3" data-path="teaching-with-r.html"><a href="teaching-with-r.html#free-and-open-source"><i class="fa fa-check"></i><b>14.3</b> Free and open source</a></li>
<li class="chapter" data-level="14.4" data-path="teaching-with-r.html"><a href="teaching-with-r.html#wide-range-of-activities"><i class="fa fa-check"></i><b>14.4</b> Wide range of activities</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="day-3-capstone-project.html"><a href="day-3-capstone-project.html"><i class="fa fa-check"></i><b>15</b> Day 3 Capstone Project</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Lecture Notes: Data Science using R for Humanities and Social Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tidying-data" class="section level1">
<h1><span class="header-section-number">7</span> Tidying data</h1>
<p>This section is concerned with common problems in data preparation, namely use cases commonly found in raw datasets that need to be addressed to turn messy data into tidy data. These would be operations that you would perform on data obtained as a csv file from a collaborator or data repository, or as the result of scraping data from webpages or other sources. We derive many of our ideas from the paper <a href="http://www.jstatsoft.org/v59/i10/paper">Tidy Data</a> by Hadley Wickham. Associated with that paper we will use two very powerful R libraries <code>tidyr</code> and <code>dplyr</code> which are extremely useful in writing scripts for data cleaning, preparation and summarization. A basic design principle behind these libraries is trying to effectively and efficiently capture very common use cases and operations performed in data cleaning. The paper frames these use cases and operations which are them implemented in software.</p>
<div id="tidy-data" class="section level2">
<h2><span class="header-section-number">7.1</span> Tidy Data</h2>
<p>Here we assume we are working with a data model based on rectangular data structures where</p>
<ol style="list-style-type: decimal">
<li>Each attribute (or variable) forms a column<br />
</li>
<li>Each entity (or observation) forms a row<br />
</li>
<li>Each type of entity (observational unit) forms a table</li>
</ol>
<p>Here is an example of a tidy dataset:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(nycflights13)
<span class="kw">head</span>(flights)</code></pre></div>
<pre><code>## # A tibble: 6 x 19
##    year month   day dep_time sched_dep_time dep_delay arr_time
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
## 1  2013     1     1      517            515         2      830
## 2  2013     1     1      533            529         4      850
## 3  2013     1     1      542            540         2      923
## 4  2013     1     1      544            545        -1     1004
## 5  2013     1     1      554            600        -6      812
## 6  2013     1     1      554            558        -4      740
## # ... with 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;</code></pre>
<p>it has one observation per row, a single variable per column. Notice only information about flights are included here (e.g., no airport information other than the name) in these observations.</p>
</div>
<div id="common-problems-in-messy-data" class="section level2">
<h2><span class="header-section-number">7.2</span> Common problems in messy data</h2>
<p>The set of common operations we will study are based on these common problems found in datasets. We will see each one in detail:</p>
<ul>
<li>Column headers are values, not variable names (gather)<br />
</li>
<li>Multiple variables stored in one column (split)<br />
</li>
<li>Variables stored in both rows and column (rotate)<br />
</li>
<li>Multiple types of observational units are stored in the same table (normalize)<br />
</li>
<li>Single observational unit stored in multiple tables (join)</li>
</ul>
<p>We are using data from Hadley’s paper found in <a href="https://github.com/hadley/tidyr">github</a>. It’s included directory <code>data</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data_dir &lt;-<span class="st"> &quot;data&quot;</span></code></pre></div>
<div id="headers-as-values" class="section level3">
<h3><span class="header-section-number">7.2.1</span> Headers as values</h3>
<p>The first problem we’ll see is the case where a table header contains values. At this point we will introduce the <code>dplyr</code> package, which we’ll use extensively in this course. It is an extremely powerful and efficient way of manipulating tidy data. It will serve as the core of our data manipulation knowledge after this course.</p>
<p><code>dplyr</code> defines a slightly different way of using data.frames. The <code>tbl_df</code> function converts a standard R data.frame into a <code>tbl_df</code> defined by <code>dplyr</code>. One nice thing it does, for example, is print tables in a much friendlier way.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyr)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(readr)

pew &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">file.path</span>(data_dir, <span class="st">&quot;pew.csv&quot;</span>))</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   religion = col_character(),
##   `&lt;$10k` = col_integer(),
##   `$10-20k` = col_integer(),
##   `$20-30k` = col_integer(),
##   `$30-40k` = col_integer(),
##   `$40-50k` = col_integer(),
##   `$50-75k` = col_integer(),
##   `$75-100k` = col_integer(),
##   `$100-150k` = col_integer(),
##   `&gt;150k` = col_integer(),
##   `Don&#39;t know/refused` = col_integer()
## )</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pew</code></pre></div>
<pre><code>## # A tibble: 18 x 11
##                   religion `&lt;$10k` `$10-20k` `$20-30k`
##                      &lt;chr&gt;   &lt;int&gt;     &lt;int&gt;     &lt;int&gt;
##  1                Agnostic      27        34        60
##  2                 Atheist      12        27        37
##  3                Buddhist      27        21        30
##  4                Catholic     418       617       732
##  5      Don’t know/refused      15        14        15
##  6        Evangelical Prot     575       869      1064
##  7                   Hindu       1         9         7
##  8 Historically Black Prot     228       244       236
##  9       Jehovah&#39;s Witness      20        27        24
## 10                  Jewish      19        19        25
## 11           Mainline Prot     289       495       619
## 12                  Mormon      29        40        48
## 13                  Muslim       6         7         9
## 14                Orthodox      13        17        23
## 15         Other Christian       9         7        11
## 16            Other Faiths      20        33        40
## 17   Other World Religions       5         2         3
## 18            Unaffiliated     217       299       374
## # ... with 7 more variables: `$30-40k` &lt;int&gt;, `$40-50k` &lt;int&gt;,
## #   `$50-75k` &lt;int&gt;, `$75-100k` &lt;int&gt;, `$100-150k` &lt;int&gt;, `&gt;150k` &lt;int&gt;,
## #   `Don&#39;t know/refused` &lt;int&gt;</code></pre>
<p>This table has the number of survey respondents of a specific religion that report their income within some range. A tidy version of this table would consider the <em>variables</em> of each observation to be <code>religion, income, frequency</code> where <code>frequency</code> has the number of respondents for each religion and income range. The function to use in the <code>tidyr</code> package is <code>gather</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_pew &lt;-<span class="st"> </span><span class="kw">gather</span>(pew, income, frequency, <span class="op">-</span>religion)
tidy_pew</code></pre></div>
<pre><code>## # A tibble: 180 x 3
##                   religion income frequency
##                      &lt;chr&gt;  &lt;chr&gt;     &lt;int&gt;
##  1                Agnostic  &lt;$10k        27
##  2                 Atheist  &lt;$10k        12
##  3                Buddhist  &lt;$10k        27
##  4                Catholic  &lt;$10k       418
##  5      Don’t know/refused  &lt;$10k        15
##  6        Evangelical Prot  &lt;$10k       575
##  7                   Hindu  &lt;$10k         1
##  8 Historically Black Prot  &lt;$10k       228
##  9       Jehovah&#39;s Witness  &lt;$10k        20
## 10                  Jewish  &lt;$10k        19
## # ... with 170 more rows</code></pre>
<p>This says: gather all the columns from the <code>pew</code> (except <code>religion</code>) into key-value columns <code>income</code> and <code>frequency</code>. This table is much easier to use in other analyses.</p>
<p>Another example: this table has a row for each song appearing in the billboard top 100. It contains track information, and the date it entered the top 100. It then shows the rank in each of the next 76 weeks.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">billboard &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">file.path</span>(data_dir, <span class="st">&quot;billboard.csv&quot;</span>))</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_integer(),
##   artist = col_character(),
##   track = col_character(),
##   time = col_time(format = &quot;&quot;),
##   date.entered = col_date(format = &quot;&quot;),
##   wk66 = col_character(),
##   wk67 = col_character(),
##   wk68 = col_character(),
##   wk69 = col_character(),
##   wk70 = col_character(),
##   wk71 = col_character(),
##   wk72 = col_character(),
##   wk73 = col_character(),
##   wk74 = col_character(),
##   wk75 = col_character(),
##   wk76 = col_character()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">billboard</code></pre></div>
<pre><code>## # A tibble: 317 x 81
##     year         artist                   track     time date.entered
##    &lt;int&gt;          &lt;chr&gt;                   &lt;chr&gt;   &lt;time&gt;       &lt;date&gt;
##  1  2000          2 Pac Baby Don&#39;t Cry (Keep... 04:22:00   2000-02-26
##  2  2000        2Ge+her The Hardest Part Of ... 03:15:00   2000-09-02
##  3  2000   3 Doors Down              Kryptonite 03:53:00   2000-04-08
##  4  2000   3 Doors Down                   Loser 04:24:00   2000-10-21
##  5  2000       504 Boyz           Wobble Wobble 03:35:00   2000-04-15
##  6  2000           98^0 Give Me Just One Nig... 03:24:00   2000-08-19
##  7  2000        A*Teens           Dancing Queen 03:44:00   2000-07-08
##  8  2000        Aaliyah           I Don&#39;t Wanna 04:15:00   2000-01-29
##  9  2000        Aaliyah               Try Again 04:03:00   2000-03-18
## 10  2000 Adams, Yolanda           Open My Heart 05:30:00   2000-08-26
## # ... with 307 more rows, and 76 more variables: wk1 &lt;int&gt;, wk2 &lt;int&gt;,
## #   wk3 &lt;int&gt;, wk4 &lt;int&gt;, wk5 &lt;int&gt;, wk6 &lt;int&gt;, wk7 &lt;int&gt;, wk8 &lt;int&gt;,
## #   wk9 &lt;int&gt;, wk10 &lt;int&gt;, wk11 &lt;int&gt;, wk12 &lt;int&gt;, wk13 &lt;int&gt;, wk14 &lt;int&gt;,
## #   wk15 &lt;int&gt;, wk16 &lt;int&gt;, wk17 &lt;int&gt;, wk18 &lt;int&gt;, wk19 &lt;int&gt;,
## #   wk20 &lt;int&gt;, wk21 &lt;int&gt;, wk22 &lt;int&gt;, wk23 &lt;int&gt;, wk24 &lt;int&gt;,
## #   wk25 &lt;int&gt;, wk26 &lt;int&gt;, wk27 &lt;int&gt;, wk28 &lt;int&gt;, wk29 &lt;int&gt;,
## #   wk30 &lt;int&gt;, wk31 &lt;int&gt;, wk32 &lt;int&gt;, wk33 &lt;int&gt;, wk34 &lt;int&gt;,
## #   wk35 &lt;int&gt;, wk36 &lt;int&gt;, wk37 &lt;int&gt;, wk38 &lt;int&gt;, wk39 &lt;int&gt;,
## #   wk40 &lt;int&gt;, wk41 &lt;int&gt;, wk42 &lt;int&gt;, wk43 &lt;int&gt;, wk44 &lt;int&gt;,
## #   wk45 &lt;int&gt;, wk46 &lt;int&gt;, wk47 &lt;int&gt;, wk48 &lt;int&gt;, wk49 &lt;int&gt;,
## #   wk50 &lt;int&gt;, wk51 &lt;int&gt;, wk52 &lt;int&gt;, wk53 &lt;int&gt;, wk54 &lt;int&gt;,
## #   wk55 &lt;int&gt;, wk56 &lt;int&gt;, wk57 &lt;int&gt;, wk58 &lt;int&gt;, wk59 &lt;int&gt;,
## #   wk60 &lt;int&gt;, wk61 &lt;int&gt;, wk62 &lt;int&gt;, wk63 &lt;int&gt;, wk64 &lt;int&gt;,
## #   wk65 &lt;int&gt;, wk66 &lt;chr&gt;, wk67 &lt;chr&gt;, wk68 &lt;chr&gt;, wk69 &lt;chr&gt;,
## #   wk70 &lt;chr&gt;, wk71 &lt;chr&gt;, wk72 &lt;chr&gt;, wk73 &lt;chr&gt;, wk74 &lt;chr&gt;,
## #   wk75 &lt;chr&gt;, wk76 &lt;chr&gt;</code></pre>
<p>Challenge: This dataset has values as column names. Which column names are values? How do we tidy this dataset?</p>
</div>
<div id="multiple-variables-in-one-column" class="section level3">
<h3><span class="header-section-number">7.2.2</span> Multiple variables in one column</h3>
<p>The next problem we’ll see is the case when we see multiple variables in a single column. Consider the following dataset of tuberculosis cases:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tb &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">file.path</span>(data_dir, <span class="st">&quot;tb.csv&quot;</span>))</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_integer(),
##   iso2 = col_character()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tb</code></pre></div>
<pre><code>## # A tibble: 5,769 x 22
##     iso2  year   m04  m514  m014 m1524 m2534 m3544 m4554 m5564   m65    mu
##    &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1    AD  1989    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
##  2    AD  1990    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
##  3    AD  1991    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
##  4    AD  1992    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
##  5    AD  1993    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
##  6    AD  1994    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
##  7    AD  1996    NA    NA     0     0     0     4     1     0     0    NA
##  8    AD  1997    NA    NA     0     0     1     2     2     1     6    NA
##  9    AD  1998    NA    NA     0     0     0     1     0     0     0    NA
## 10    AD  1999    NA    NA     0     0     0     1     1     0     0    NA
## # ... with 5,759 more rows, and 10 more variables: f04 &lt;int&gt;, f514 &lt;int&gt;,
## #   f014 &lt;int&gt;, f1524 &lt;int&gt;, f2534 &lt;int&gt;, f3544 &lt;int&gt;, f4554 &lt;int&gt;,
## #   f5564 &lt;int&gt;, f65 &lt;int&gt;, fu &lt;int&gt;</code></pre>
<p>This table has a row for each year and strain of tuberculosis (given by the first two columns). The remaining columns state the number of cases for a given demographic. For example, <code>m1524</code> corresponds to males between 15 and 24 years old, and <code>f1524</code> are females age 15-24. As you can see each of these columns has two variables: <code>sex</code> and <code>age</code>.</p>
<p>Challenge: what else is untidy about this dataset?</p>
<p>So, we have to do two operations to tidy this table, first we need to use <code>gather</code> the tabulation columns into a <code>demo</code> and <code>n</code> columns (for demographic and number of cases):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_tb &lt;-<span class="st"> </span><span class="kw">gather</span>(tb, demo, n, <span class="op">-</span>iso2, <span class="op">-</span>year)
tidy_tb</code></pre></div>
<pre><code>## # A tibble: 115,380 x 4
##     iso2  year  demo     n
##    &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;int&gt;
##  1    AD  1989   m04    NA
##  2    AD  1990   m04    NA
##  3    AD  1991   m04    NA
##  4    AD  1992   m04    NA
##  5    AD  1993   m04    NA
##  6    AD  1994   m04    NA
##  7    AD  1996   m04    NA
##  8    AD  1997   m04    NA
##  9    AD  1998   m04    NA
## 10    AD  1999   m04    NA
## # ... with 115,370 more rows</code></pre>
<p>Next, we need to <code>separate</code> the values in the <code>demo</code> column into two variables <code>sex</code> and <code>age</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_tb &lt;-<span class="st"> </span><span class="kw">separate</span>(tidy_tb, demo, <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>), <span class="dt">sep=</span><span class="dv">1</span>)
tidy_tb</code></pre></div>
<pre><code>## # A tibble: 115,380 x 5
##     iso2  year   sex   age     n
##  * &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
##  1    AD  1989     m    04    NA
##  2    AD  1990     m    04    NA
##  3    AD  1991     m    04    NA
##  4    AD  1992     m    04    NA
##  5    AD  1993     m    04    NA
##  6    AD  1994     m    04    NA
##  7    AD  1996     m    04    NA
##  8    AD  1997     m    04    NA
##  9    AD  1998     m    04    NA
## 10    AD  1999     m    04    NA
## # ... with 115,370 more rows</code></pre>
<p>This calls the <code>separate</code> function on table <code>tidy_db</code>, separating the <code>demo</code> variable into variables <code>sex</code> and <code>age</code> by separating each value after the first character (that’s the <code>sep</code> argument).</p>
<p>We can put these two commands together in a pipeline:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_tb &lt;-<span class="st"> </span>tb <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(demo, n, <span class="op">-</span>iso2, <span class="op">-</span>year)  <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">separate</span>(demo, <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>), <span class="dt">sep=</span><span class="dv">1</span>)
tidy_tb</code></pre></div>
<pre><code>## # A tibble: 115,380 x 5
##     iso2  year   sex   age     n
##  * &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
##  1    AD  1989     m    04    NA
##  2    AD  1990     m    04    NA
##  3    AD  1991     m    04    NA
##  4    AD  1992     m    04    NA
##  5    AD  1993     m    04    NA
##  6    AD  1994     m    04    NA
##  7    AD  1996     m    04    NA
##  8    AD  1997     m    04    NA
##  9    AD  1998     m    04    NA
## 10    AD  1999     m    04    NA
## # ... with 115,370 more rows</code></pre>
</div>
<div id="variables-stored-in-both-rows-and-columns" class="section level3">
<h3><span class="header-section-number">7.2.3</span> Variables stored in both rows and columns</h3>
<p>This is the messiest, commonly found type of data. Let’s take a look at an example, this is daily weather data from for one weather station in Mexico in 2010.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">weather &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">file.path</span>(data_dir, <span class="st">&quot;weather.csv&quot;</span>))</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_double(),
##   id = col_character(),
##   year = col_integer(),
##   month = col_integer(),
##   element = col_character(),
##   d9 = col_character(),
##   d12 = col_character(),
##   d18 = col_character(),
##   d19 = col_character(),
##   d20 = col_character(),
##   d21 = col_character(),
##   d22 = col_character(),
##   d24 = col_character()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">weather</code></pre></div>
<pre><code>## # A tibble: 22 x 35
##         id  year month element    d1    d2    d3    d4    d5    d6    d7
##      &lt;chr&gt; &lt;int&gt; &lt;int&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 MX17004  2010     1    tmax    NA    NA    NA    NA    NA    NA    NA
##  2 MX17004  2010     1    tmin    NA    NA    NA    NA    NA    NA    NA
##  3 MX17004  2010     2    tmax    NA  27.3  24.1    NA    NA    NA    NA
##  4 MX17004  2010     2    tmin    NA  14.4  14.4    NA    NA    NA    NA
##  5 MX17004  2010     3    tmax    NA    NA    NA    NA  32.1    NA    NA
##  6 MX17004  2010     3    tmin    NA    NA    NA    NA  14.2    NA    NA
##  7 MX17004  2010     4    tmax    NA    NA    NA    NA    NA    NA    NA
##  8 MX17004  2010     4    tmin    NA    NA    NA    NA    NA    NA    NA
##  9 MX17004  2010     5    tmax    NA    NA    NA    NA    NA    NA    NA
## 10 MX17004  2010     5    tmin    NA    NA    NA    NA    NA    NA    NA
## # ... with 12 more rows, and 24 more variables: d8 &lt;dbl&gt;, d9 &lt;chr&gt;,
## #   d10 &lt;dbl&gt;, d11 &lt;dbl&gt;, d12 &lt;chr&gt;, d13 &lt;dbl&gt;, d14 &lt;dbl&gt;, d15 &lt;dbl&gt;,
## #   d16 &lt;dbl&gt;, d17 &lt;dbl&gt;, d18 &lt;chr&gt;, d19 &lt;chr&gt;, d20 &lt;chr&gt;, d21 &lt;chr&gt;,
## #   d22 &lt;chr&gt;, d23 &lt;dbl&gt;, d24 &lt;chr&gt;, d25 &lt;dbl&gt;, d26 &lt;dbl&gt;, d27 &lt;dbl&gt;,
## #   d28 &lt;dbl&gt;, d29 &lt;dbl&gt;, d30 &lt;dbl&gt;, d31 &lt;dbl&gt;</code></pre>
<p>So, we have two rows for each month, one with maximum daily temperature, one with minimum daily temperature, the columns starting with <code>d</code> correspond to the day in the where the measurements were made.</p>
<p>Challenge: How would a tidy version of this data look like?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">weather <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(day, value, d1<span class="op">:</span>d31, <span class="dt">na.rm=</span><span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread</span>(element, value)</code></pre></div>
<pre><code>## # A tibble: 33 x 6
##         id  year month   day  tmax  tmin
##  *   &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
##  1 MX17004  2010     1   d30  27.8  14.5
##  2 MX17004  2010     2   d11  29.7  13.4
##  3 MX17004  2010     2    d2  27.3  14.4
##  4 MX17004  2010     2   d23  29.9  10.7
##  5 MX17004  2010     2    d3  24.1  14.4
##  6 MX17004  2010     3   d10  34.5  16.8
##  7 MX17004  2010     3   d16  31.1  17.6
##  8 MX17004  2010     3    d5  32.1  14.2
##  9 MX17004  2010     4   d27  36.3  16.7
## 10 MX17004  2010     5   d27  33.2  18.2
## # ... with 23 more rows</code></pre>
<p>The new function we’ve used here is <code>spread</code>. It does the inverse of <code>gather</code> it spreads columns <code>element</code> and <code>value</code> into separate columns.</p>
</div>
<div id="multiple-types-in-one-table" class="section level3">
<h3><span class="header-section-number">7.2.4</span> Multiple types in one table</h3>
<p>Remember that an important aspect of tidy data is that it contains exactly one kind of observation in a single table. Let’s see the billboard example again after the <code>gather</code> operation we did before:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_billboard &lt;-<span class="st"> </span>billboard <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(week, rank, wk1<span class="op">:</span>wk76, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)
tidy_billboard</code></pre></div>
<pre><code>## # A tibble: 5,307 x 7
##     year         artist                   track     time date.entered
##  * &lt;int&gt;          &lt;chr&gt;                   &lt;chr&gt;   &lt;time&gt;       &lt;date&gt;
##  1  2000          2 Pac Baby Don&#39;t Cry (Keep... 04:22:00   2000-02-26
##  2  2000        2Ge+her The Hardest Part Of ... 03:15:00   2000-09-02
##  3  2000   3 Doors Down              Kryptonite 03:53:00   2000-04-08
##  4  2000   3 Doors Down                   Loser 04:24:00   2000-10-21
##  5  2000       504 Boyz           Wobble Wobble 03:35:00   2000-04-15
##  6  2000           98^0 Give Me Just One Nig... 03:24:00   2000-08-19
##  7  2000        A*Teens           Dancing Queen 03:44:00   2000-07-08
##  8  2000        Aaliyah           I Don&#39;t Wanna 04:15:00   2000-01-29
##  9  2000        Aaliyah               Try Again 04:03:00   2000-03-18
## 10  2000 Adams, Yolanda           Open My Heart 05:30:00   2000-08-26
## # ... with 5,297 more rows, and 2 more variables: week &lt;chr&gt;, rank &lt;chr&gt;</code></pre>
<p>Let’s sort this table by track to see a problem with this table:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_billboard &lt;-<span class="st"> </span>tidy_billboard <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(track)
tidy_billboard</code></pre></div>
<pre><code>## # A tibble: 5,307 x 7
##     year artist                   track     time date.entered  week  rank
##    &lt;int&gt;  &lt;chr&gt;                   &lt;chr&gt;   &lt;time&gt;       &lt;date&gt; &lt;chr&gt; &lt;chr&gt;
##  1  2000  Nelly (Hot S**t) Country G... 04:17:00   2000-04-29   wk1   100
##  2  2000  Nelly (Hot S**t) Country G... 04:17:00   2000-04-29   wk2    99
##  3  2000  Nelly (Hot S**t) Country G... 04:17:00   2000-04-29   wk3    96
##  4  2000  Nelly (Hot S**t) Country G... 04:17:00   2000-04-29   wk4    76
##  5  2000  Nelly (Hot S**t) Country G... 04:17:00   2000-04-29   wk5    55
##  6  2000  Nelly (Hot S**t) Country G... 04:17:00   2000-04-29   wk6    37
##  7  2000  Nelly (Hot S**t) Country G... 04:17:00   2000-04-29   wk7    24
##  8  2000  Nelly (Hot S**t) Country G... 04:17:00   2000-04-29   wk8    24
##  9  2000  Nelly (Hot S**t) Country G... 04:17:00   2000-04-29   wk9    30
## 10  2000  Nelly (Hot S**t) Country G... 04:17:00   2000-04-29  wk10    36
## # ... with 5,297 more rows</code></pre>
<p>We have a lot of repeated information in many of these rows (the artist, track name, year, title and date entered). The problem is that this table contains information about both tracks and rank in billboard. That’s two different kinds of observations that should belong in two different tables in a tidy dataset.</p>
<p>Let’s make a song table that only includes information about songs:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">song &lt;-<span class="st"> </span>tidy_billboard <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(artist, track, year, time, date.entered) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unique</span>()
song</code></pre></div>
<pre><code>## # A tibble: 317 x 5
##           artist                   track  year     time date.entered
##            &lt;chr&gt;                   &lt;chr&gt; &lt;int&gt;   &lt;time&gt;       &lt;date&gt;
##  1         Nelly (Hot S**t) Country G...  2000 04:17:00   2000-04-29
##  2     Nu Flavor          3 Little Words  2000 03:54:00   2000-06-03
##  3  Jean, Wyclef                     911  2000 04:00:00   2000-10-07
##  4   Brock, Chad A Country Boy Can Su...  2000 03:54:00   2000-01-01
##  5  Clark, Terri       A Little Gasoline  2000 03:07:00   2000-12-16
##  6   Son By Four A Puro Dolor (Purest...  2000 03:30:00   2000-04-08
##  7 Carter, Aaron Aaron&#39;s Party (Come ...  2000 03:23:00   2000-08-26
##  8     Nine Days Absolutely (Story Of...  2000 03:09:00   2000-05-06
##  9    De La Soul               All Good?  2000 05:02:00   2000-12-23
## 10     Blink-182    All The Small Things  2000 02:52:00   1999-12-04
## # ... with 307 more rows</code></pre>
<p>The <code>unique</code> function removes any duplicate rows in a table. That’s how we have a single row for each song.</p>
<p>Next, we would like to remove all the song information from the rank table. But we need to do it in a way that still remembers which song each ranking observation corresponds to. To do that, let’s first give each song an identifier that we can use to link songs and rankings. So, we can produce the final version of our song table like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">song &lt;-<span class="st"> </span>tidy_billboard <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(artist, track, year, time, date.entered) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unique</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">song_id =</span> <span class="kw">row_number</span>())
song</code></pre></div>
<pre><code>## # A tibble: 317 x 6
##           artist                   track  year     time date.entered
##            &lt;chr&gt;                   &lt;chr&gt; &lt;int&gt;   &lt;time&gt;       &lt;date&gt;
##  1         Nelly (Hot S**t) Country G...  2000 04:17:00   2000-04-29
##  2     Nu Flavor          3 Little Words  2000 03:54:00   2000-06-03
##  3  Jean, Wyclef                     911  2000 04:00:00   2000-10-07
##  4   Brock, Chad A Country Boy Can Su...  2000 03:54:00   2000-01-01
##  5  Clark, Terri       A Little Gasoline  2000 03:07:00   2000-12-16
##  6   Son By Four A Puro Dolor (Purest...  2000 03:30:00   2000-04-08
##  7 Carter, Aaron Aaron&#39;s Party (Come ...  2000 03:23:00   2000-08-26
##  8     Nine Days Absolutely (Story Of...  2000 03:09:00   2000-05-06
##  9    De La Soul               All Good?  2000 05:02:00   2000-12-23
## 10     Blink-182    All The Small Things  2000 02:52:00   1999-12-04
## # ... with 307 more rows, and 1 more variables: song_id &lt;int&gt;</code></pre>
<p>The <code>mutate</code> function adds a new column to the table, in this case with column name <code>song_id</code> and value the row number the song appears in the table (from the <code>row_number</code> column).</p>
<p>Now we can make a rank table, we combine the tidy billboard table with our new song table using a <code>join</code> (we’ll learn all about joins later). It checks the values on each row of the billboard table and looks for rows in the song table that have the exact same values, and makes a new row that combines the information from both tables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tidy_billboard <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(song, <span class="kw">c</span>(<span class="st">&quot;artist&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;track&quot;</span>, <span class="st">&quot;time&quot;</span>, <span class="st">&quot;date.entered&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 5,307 x 8
##     year artist                   track     time date.entered  week  rank
##    &lt;int&gt;  &lt;chr&gt;                   &lt;chr&gt;   &lt;time&gt;       &lt;date&gt; &lt;chr&gt; &lt;chr&gt;
##  1  2000  Nelly (Hot S**t) Country G... 04:17:00   2000-04-29   wk1   100
##  2  2000  Nelly (Hot S**t) Country G... 04:17:00   2000-04-29   wk2    99
##  3  2000  Nelly (Hot S**t) Country G... 04:17:00   2000-04-29   wk3    96
##  4  2000  Nelly (Hot S**t) Country G... 04:17:00   2000-04-29   wk4    76
##  5  2000  Nelly (Hot S**t) Country G... 04:17:00   2000-04-29   wk5    55
##  6  2000  Nelly (Hot S**t) Country G... 04:17:00   2000-04-29   wk6    37
##  7  2000  Nelly (Hot S**t) Country G... 04:17:00   2000-04-29   wk7    24
##  8  2000  Nelly (Hot S**t) Country G... 04:17:00   2000-04-29   wk8    24
##  9  2000  Nelly (Hot S**t) Country G... 04:17:00   2000-04-29   wk9    30
## 10  2000  Nelly (Hot S**t) Country G... 04:17:00   2000-04-29  wk10    36
## # ... with 5,297 more rows, and 1 more variables: song_id &lt;int&gt;</code></pre>
<p>That adds the <code>song_id</code> variable to the <code>tidy_billboard</code> table. So now we can remove the song information and only keep ranking information and the <code>song_id</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rank &lt;-<span class="st"> </span>tidy_billboard <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(song, <span class="kw">c</span>(<span class="st">&quot;artist&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;track&quot;</span>, <span class="st">&quot;time&quot;</span>, <span class="st">&quot;date.entered&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(song_id, week, rank)
rank</code></pre></div>
<pre><code>## # A tibble: 5,307 x 3
##    song_id  week  rank
##      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1       1   wk1   100
##  2       1   wk2    99
##  3       1   wk3    96
##  4       1   wk4    76
##  5       1   wk5    55
##  6       1   wk6    37
##  7       1   wk7    24
##  8       1   wk8    24
##  9       1   wk9    30
## 10       1  wk10    36
## # ... with 5,297 more rows</code></pre>
<p>Challenge: Let’s do a little better job at tidying the billboard dataset:</p>
<ol style="list-style-type: decimal">
<li>When using <code>gather</code> to make the <code>week</code> and <code>rank</code> columns, remove any weeks where the song does not appear in the top 100. This is coded as missing (<code>NA</code>). See the <code>na.rm</code> argument to <code>gather</code>.<br />
</li>
<li>Make <code>week</code> a numeric variable (i.e., remove <code>wk</code>). See what the <code>extract_numeric</code> function does.<br />
</li>
<li>Instead of <code>date.entered</code> add a <code>date</code> column that states the actual date of each ranking. See how R deals with dates <code>?Date</code> and how you can turn a string into a <code>Date</code> using <code>as.Date</code>.<br />
</li>
<li>Sort the resulting table by date and rank.</li>
<li>Make new <code>song</code> and <code>rank</code> tables. <code>song</code> will now not have the <code>date.entered</code> column, and <code>rank</code> will have the new <code>date</code> column you have just created.</li>
</ol>
</div>
</div>
<div id="data-wrangling-with-dplyr" class="section level2">
<h2><span class="header-section-number">7.3</span> Data wrangling with <code>dplyr</code></h2>
<p>In previous lectures we discussed the <code>data.frame</code> to introduced the structure we usually see in a dataset before we start analysis:</p>
<ol style="list-style-type: decimal">
<li>Each attribute/variable forms a column</li>
<li>Each entity/(observational unit) forms a row</li>
<li>Each type of entity/(observation unit) forms a table</li>
</ol>
<p>Although we did not explicitly mentioned number 3, in more complex datasets we want to make sure we divide different entity types into their respective table. We will discuss this in more detail when we see data models (in the database sense) later on. We will refer to data organized in this fashion as <em>tidy data</em>.</p>
<p>In this section we introduce operations and manipulations that commonly arise in analyses. We center our discussion around the idea that we are operating over tidy data, and we want to ensure that the operations we apply also generate tidy data as a result.</p>
<div id="dplyr" class="section level3">
<h3><span class="header-section-number">7.3.1</span> <code>dplyr</code></h3>
<p>We will use the <code>dplyr</code> package to introduce these oprations. I think it is one of the most beautiful tools created for data analysis. It clearly defines and efficiently implements most common data manipulation operations (verbs) one comes across in data analysis. It is built around tidy data principles. It also presents uniform treatment of multiple kinds of data sources (in memory files, partially loaded files, databases). It works best when used in conjuction with the non-standard <em>pipe</em> operator (<code>%&gt;%</code>) first introduced by the <code>magrittr</code> package.</p>
<p>A complete introduction to <code>dplyr</code> is found here: <a href="http://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html" class="uri">http://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html</a></p>
<p>We will use a dataset of inbound and outbound flights to New York City as an example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(nycflights13)
<span class="kw">data</span>(flights)</code></pre></div>
</div>
</div>
<div id="single-table-manipulation" class="section level2">
<h2><span class="header-section-number">7.4</span> Single-table manipulation</h2>
<p>We will first look at operations that work over a single table at a time.</p>
<p>Single table verbs:</p>
<ul>
<li><code>filter()</code> and <code>slice()</code>: subset observations (entities)<br />
</li>
<li><code>arrange()</code>: sort observations (entities)<br />
</li>
<li><code>select()</code> and <code>rename()</code>: subset variables (attributes)<br />
</li>
<li><code>distinct()</code>: make entities unique<br />
</li>
<li><code>mutate()</code> and <code>transmutate()</code>: add a new variable (attribute)<br />
</li>
<li><code>summarize()</code>: compute a summary statistics for one or more variables<br />
</li>
<li><code>sample_n()</code> and <code>sample_frac()</code>: sample observations from a data table</li>
</ul>
<div id="subsetting-observations" class="section level3">
<h3><span class="header-section-number">7.4.1</span> Subsetting Observations</h3>
<p>The first fundamental operation we learned about early in this course is subsetting, or filtering, observations (entities, rows) in a dataset. Recall that we could subset by a set of indices (say, all even rows, this is used when splitting datasets to train and test statistical models). Much more useful is the ability to filter observations based on attribute values.</p>
<div class="figure">
<img src="img/subset.png" />

</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># include only flights on United Airlines</span>
flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(carrier <span class="op">==</span><span class="st"> &quot;UA&quot;</span>)

<span class="co"># select even samples, note function `n` defined by dplyr</span>
flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="kw">seq</span>(<span class="dv">1</span>, <span class="kw">n</span>(), <span class="dt">by=</span><span class="dv">2</span>))</code></pre></div>
</div>
<div id="subsetting-variables" class="section level3">
<h3><span class="header-section-number">7.4.2</span> Subsetting Variables</h3>
<p>Frequently, we may want to restrict a data analysis to a subset of variables (attributes, columns) to improve efficiency or interpretability.</p>
<div class="figure">
<img src="img/select.png" />

</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># select only month carrier and origin variables</span>
flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(month, carrier, origin)</code></pre></div>
<p>On large, complex, datasets the ability to perform this selection based on properties of column/attribute names is very powerful. For instance, in the <code>billboard</code> dataset we saw in a previous unit, we can select columns using partial string matching:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">billboard <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;wk&quot;</span>))</code></pre></div>
</div>
<div id="creating-new-variables" class="section level3">
<h3><span class="header-section-number">7.4.3</span> Creating New Variables</h3>
<p>One of the most common operations in data analysis is to create new variables (attributes), based on other existing attributes.</p>
<div class="figure">
<img src="img/mutate.png" />

</div>
<p>These manipulations are used for transformations of existing single variables, for example, squaring a given varaible (<code>x -&gt; x^2</code>), to make visualization or other downstream analysis more effective. In other cases, we may want to compute functions of existing variables to improve analysis or interpretation of a dataset.</p>
<p>Here is an example creating a new variable as a function of two existing variables</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># add new variable with total delay</span>
flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">delay=</span>dep_delay <span class="op">+</span><span class="st"> </span>arr_delay)</code></pre></div>
</div>
<div id="summarizing-data" class="section level3">
<h3><span class="header-section-number">7.4.4</span> Summarizing Data</h3>
<p>Much of statistical analysis, modeling and visualization is based on computing summaries (refered to as summary statistics) for variables (attributes), or other data features, of datasets. The <code>summarize</code> operation summarizes one variable (columns) over multiple observations (rowss) into a single value.</p>
<div class="figure">
<img src="img/summarize.png" />

</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># compute mean total delay across all flights</span>
flights <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">delay =</span> dep_delay <span class="op">+</span><span class="st"> </span>arr_delay) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mean_delay =</span> <span class="kw">mean</span>(delay, <span class="dt">na.rm=</span><span class="ot">TRUE</span>),
            <span class="dt">min_delay =</span> <span class="kw">min</span>(delay, <span class="dt">na.rm=</span><span class="ot">TRUE</span>),
            <span class="dt">max_delay =</span> <span class="kw">max</span>(delay, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))</code></pre></div>
</div>
<div id="grouping-data" class="section level3">
<h3><span class="header-section-number">7.4.5</span> Grouping Data</h3>
<p>Aggregation and summarization also go hand in hand with data grouping, where aggregates, or even variable transformations are performed <em>conditioned</em> on other variables. The notion of <em>conditioning</em> is fundamental and we will see it very frequently through the course. It is the basis of statistical analysis and Machine Learning models for regression and prediction, and it is essential in understanding the design of effective visualizations.</p>
<div class="figure">
<img src="img/groupby.png" />

</div>
<p>So the goal is to group observations (rows) with the same value of one or more variables (columns). In the <code>dplyr</code> implementation, the <code>group_by</code> function in essence annotates the rows of a data table as belonging to a specific group. When <code>summarize</code> is the applied onto this annotated data table, summaries are computed for each group, rather than the whole table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># compute mean total delay per carrier</span>
flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">delay =</span> dep_delay <span class="op">+</span><span class="st"> </span>arr_delay) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(carrier) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">delay=</span><span class="kw">mean</span>(delay, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))</code></pre></div>
</div>
</div>
<div id="two-table-manipulation" class="section level2">
<h2><span class="header-section-number">7.5</span> Two-table manipulation</h2>
<p>We saw above manipulations defined over single tables. In this section we look at efficient methods to combine data from multiple tables. The fundamental operation here is the <code>join</code>, which is a workhorse of database system design and impementation. The <code>join</code> operation combines rows from two tables to create a new single table, based on matching criteria specified over attributes of each of the two tables.</p>
<p>Consider the example of joining the <code>flights</code> and <code>airlines</code> table:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(flights)</code></pre></div>
<pre><code>## # A tibble: 6 x 19
##    year month   day dep_time sched_dep_time dep_delay arr_time
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
## 1  2013     1     1      517            515         2      830
## 2  2013     1     1      533            529         4      850
## 3  2013     1     1      542            540         2      923
## 4  2013     1     1      544            545        -1     1004
## 5  2013     1     1      554            600        -6      812
## 6  2013     1     1      554            558        -4      740
## # ... with 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(airlines)</code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   carrier                     name
##     &lt;chr&gt;                    &lt;chr&gt;
## 1      9E        Endeavor Air Inc.
## 2      AA   American Airlines Inc.
## 3      AS     Alaska Airlines Inc.
## 4      B6          JetBlue Airways
## 5      DL     Delta Air Lines Inc.
## 6      EV ExpressJet Airlines Inc.</code></pre>
<p>Here, we want to add airline information to each flight. We can do so by joining the attributes of the respective airline from the <code>airlines</code> table with the <code>flights</code> table based on the values of attributes <code>flights$carrier</code> and <code>airlines$carrier</code>. Specifically, every row of <code>flights</code> with a specific value for <code>flights$carrier</code>, is joined with the the corresponding row in <code>airlines</code> with the same value for <code>airlines$carrier</code>. We will see four different ways of performing this operation that differ on how non-matching observations are handled.</p>
<div id="left-join" class="section level3">
<h3><span class="header-section-number">7.5.1</span> Left Join</h3>
<p>In this case, all observations on left operand (LHS) are retained:</p>
<p><img src="img/join_lhs.png" /> <img src="img/left_join.png" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(airlines, <span class="dt">by=</span><span class="st">&quot;carrier&quot;</span>)</code></pre></div>
<p>RHS variables for LHS observations with no matching RHS observations are coded as <code>NA</code>.</p>
<div id="right-join" class="section level4">
<h4><span class="header-section-number">7.5.1.1</span> Right Join</h4>
<p>All observations on right operand (RHS) are retained:</p>
<p><img src="img/join_lhs.png" /> <img src="img/right_join.png" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">right_join</span>(airlines, <span class="dt">by=</span><span class="st">&quot;carrier&quot;</span>)</code></pre></div>
<p>LHS variables for RHS observations with no matching LHS observations are coded as <code>NA</code>.</p>
</div>
<div id="inner-join" class="section level4">
<h4><span class="header-section-number">7.5.1.2</span> Inner Join</h4>
<p>Only observations matching on both tables are retained</p>
<p><img src="img/join_lhs.png" /> <img src="img/inner_join.png" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inner_join</span>(airlines, <span class="dt">by=</span><span class="st">&quot;carrier&quot;</span>)</code></pre></div>
</div>
<div id="full-join" class="section level4">
<h4><span class="header-section-number">7.5.1.3</span> Full Join</h4>
<p>All observations are retained, regardless of matching condition</p>
<p><img src="img/join_lhs.png" /> <img src="img/full_join.png" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">full_join</span>(airlines, <span class="dt">by=</span><span class="st">&quot;carrier&quot;</span>)</code></pre></div>
<p>All values coded as <code>NA</code> for non-matching observations as appropriate.</p>
</div>
</div>
<div id="join-conditions" class="section level3">
<h3><span class="header-section-number">7.5.2</span> Join conditions</h3>
<p>All join operations are based on a matching condition:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(airlines, <span class="dt">by=</span><span class="st">&quot;carrier&quot;</span>)</code></pre></div>
<p>specifies to join observations where <code>flights$carrier</code> equals <code>airlines$carrier</code>.</p>
<p>In this case, where no conditions are specified using the <code>by</code> argument:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(airlines)</code></pre></div>
<p>a <em>natural join</em> is perfomed. In this case all variables with the same name in both tables are used in join condition.</p>
<p>You can also specify join conditions on arbitrary attributes using the <code>by</code> argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(airlines, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;carrier&quot;</span> =<span class="st"> &quot;name&quot;</span>))</code></pre></div>
</div>
<div id="filtering-joins" class="section level3">
<h3><span class="header-section-number">7.5.3</span> Filtering Joins</h3>
<p>We’ve just seen <em>mutating joins</em> that create new tables. <em>Filtering joins</em> use join conditions to filter a specific table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">anti_join</span>(airlines, <span class="dt">by=</span><span class="st">&quot;carrier&quot;</span>)</code></pre></div>
<pre><code>## # A tibble: 0 x 19
## # ... with 19 variables: year &lt;int&gt;, month &lt;int&gt;, day &lt;int&gt;,
## #   dep_time &lt;int&gt;, sched_dep_time &lt;int&gt;, dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;,
## #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Filters the <code>flights</code> table to only include flights from airlines that <em>are not</em> included in the <code>airlines</code> table.</p>
</div>
</div>
<div id="final-note-on-dplyr" class="section level2">
<h2><span class="header-section-number">7.6</span> Final note on <code>dplyr</code></h2>
<ul>
<li>Very efficient implementation of these operations.</li>
<li>More info: <a href="http://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html" class="uri">http://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html</a></li>
<li>Cheatsheet: <a href="http://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf" class="uri">http://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf</a></li>
</ul>
</div>
<div id="exercise" class="section level2">
<h2><span class="header-section-number">7.7</span> Exercise</h2>
<ol style="list-style-type: decimal">
<li>Clean up the Diego Luna ratings data scraped in the previous unit.</li>
</ol>
<ul>
<li>Only keep movies that have a rating and that Diego Luna acts in</li>
<li>Convert the rating to a numeric variable (use the <code>str_replace</code> and <code>type_convert</code> functions)</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Clean up the movie budget data scraped in the previous unit.</li>
</ol>
<ul>
<li>Remove rows with missing values</li>
<li>Make the budget and revenue columns numeric and expressed in millions</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><p>Join the Diego Luna ratings and movie budget data using the movie title as the join variable</p></li>
<li><p>Think and implement ways of making the integration of these two datasets more robust.</p></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ingesting-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualizing-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["mtec_cadi_2017.pdf"],
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
